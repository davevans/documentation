---
id: determinism
title: Making revisions to Workflow code
description: Safely deploy changes to existing Workflow code by validating first for determinism errors before deploying to production.
sidebar_label: Determinism
toc_max_heading_level: 3
tags:
  - Workflows
  - Deployment
  - Replay
---

Making revisions to existing Workflow code can be challenging. Your Workflow code must be [deterministic](https://docs.temporal.io/workflow-definition#deterministic-constraints). This means your changes to that code have to be as well. Changes to your Workflow code that qualify as non-deterministic need to be protected by either using the [Versioning APIs](https://docs.temporal.io/workflow-definition#workflow-versioning) within your Workflow code.

## Use Replay Testing before and during your deployments

The best way to verify that your code won't cause non-determinism errors once deployed is to use [replay testing](https://docs.temporal.io/workflow-execution#replay).

Replay testing takes one or more existing [Workflow Histories](https://docs.temporal.io/workflow-execution/event#event-history) that ran against a previous version of Workflow code and runs them against your _current_ Workflow code, verifying that it is compatible with the provided history.

There are multiple points in your development lifecycle where running replay tests can make sense. They exist on a spectrum, with shortest time to feedback on one end, and most representative of a production deployment on the other.

- During development, replay testing lets you get feedback as early as possible on whether your changes are compatible. For example, you might include some integration tests that run your Workflows against the Temporal Test Server to produce histories which you then check in. You can use those checked-in histories for replay tests to verify you haven't made breaking changes.
- During pre-deployment validation (such as during some automated deployment validation) you can get feedback in a more representative environment. For example, you might fetch histories from a live Temporal environment (whether production or some kind of pre-production) and use them in replay tests.
- At deployment time, your environment _is_ production, but you are using the new code to replay recent real-world Workflow histories.

When you're writing changes to Workflow code, you can fetch some representative histories from your pre-production or production Temporal environment and verify they work with your changes. You can do the same with the pre-merge CI pipeline. However, if you are using encrypted Payloads, which is a typical and recommended setup in production, you may not be able to decrypt the fetched histories. Additionally if your Workflows contain any PII (which should be encrypted), make sure this information is scrubbed for the purposes of your tests, or err on the side of caution and don't use this method.

## Implement a deployment-time replay test

The key to a successful safe deployment is to break it into two phases: a verification phase, where youâ€™ll run the replay test, followed by the actual deployment of your new Worker code. Refer to the [replay testing](https://docs.temporal.io/workflow-execution#replay) docs of each SDK for implementation details.
